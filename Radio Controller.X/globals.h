#ifndef GLOBALS_H
#define	GLOBALS_H

/******************************************************************************/
/* Files to Include                                                           */
/******************************************************************************/

#include "basic.h"              /* For the basic definitions */
#include "hardware.h"           /* For the port mappings */

/******************************************************************************/
/* Messages                                                                   */
/******************************************************************************/
//
//#define OPEN_BUTTON_MSG 1
//#define OPEN_BUTTON_SIZE 157
//const uint8_t OPEN_BUTTON[OPEN_BUTTON_SIZE] = {0b11111110, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00000011, 0b11110000, 0b00111111, 0b00000000, 0b00000000, 0b00000000, 0b10000000, 0b11111111, 0b00000111, 0b00000000, 0b00000000, 0b00000000, 0b11111100, 0b00011111, 0b00000000, 0b11111111, 0b00000011, 0b11100000, 0b11111111, 0b00000000, 0b11111000, 0b00011111, 0b00000000, 0b11111111, 0b00000111, 0b00000000, 0b00000000, 0b00000000, 0b11111000, 0b00111111, 0b00000000, 0b11111110, 0b00000111, 0b11000000, 0b11111111, 0b00000001, 0b11110000, 0b00111111, 0b00000000, 0b11111110, 0b00001111, 0b10000000, 0b11111111, 0b00000001, 0b00000000, 0b00000000, 0b00000000, 0b11111100, 0b00011111, 0b00000000, 0b00000000, 0b00000000, 0b11100000, 0b11111111, 0b00000000, 0b11111000, 0b00011111, 0b00000000, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00000001, 0b11111000, 0b00111111, 0b00000000, 0b11111110, 0b00000111, 0b11000000, 0b11111111, 0b00000001, 0b11110000, 0b00111111, 0b00000000, 0b11111110, 0b00001111, 0b10000000, 0b11111111, 0b00000001, 0b11110000, 0b01111111, 0b00000000, 0b11111100, 0b00011111, 0b00000000, 0b00000000, 0b00000000, 0b11100000, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11111111, 0b00000111, 0b00000000, 0b00000000, 0b00000000, 0b11111000, 0b00111111, 0b00000000, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00000001, 0b00000000, 0b00000000, 0b00000000, 0b11111100, 0b00011111, 0b00000000, 0b00000000, 0b00000000, 0b11100000, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11111111, 0b00000111};
//

#define PWR_BUTTON_MSG 2
#define PWR_BUTTON_SIZE 163
const uint8_t PWR_BUTTON[PWR_BUTTON_SIZE] = {0b11111110, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b00011111, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11111110, 0b00111111, 0b00000000, 0b00000000, 0b00000000, 0b11110000, 0b11111111, 0b00000001, 0b11111110, 0b01111111, 0b10000000, 0b11111111, 0b00001111, 0b11110000, 0b11111111, 0b00000011, 0b11111100, 0b01111111, 0b10000000, 0b11111111, 0b00001111, 0b11100000, 0b11111111, 0b00000011, 0b11111100, 0b11111111, 0b00000000, 0b11111111, 0b00011111, 0b00000000, 0b00000000, 0b00000000, 0b11111000, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00000111, 0b00000000, 0b00000000, 0b00000000, 0b11111110, 0b00111111, 0b00000000, 0b00000000, 0b00000000, 0b11110000, 0b11111111, 0b00000001, 0b00000000, 0b00000000, 0b10000000, 0b11111111, 0b00001111, 0b00000000, 0b00000000, 0b00000000, 0b11111100, 0b01111111, 0b00000000, 0b00000000, 0b00000000, 0b11100000, 0b11111111, 0b00000011, 0b00000000, 0b00000000, 0b00000000, 0b11111111, 0b00011111, 0b11100000, 0b11111111, 0b00000011, 0b11111000, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00000111, 0b00000000, 0b00000000, 0b00000000, 0b11111110, 0b00111111, 0b11000000, 0b11111111, 0b00000111, 0b00000000, 0b00000000, 0b00000000, 0b11111110, 0b00111111, 0b10000000, 0b11111111, 0b00001111, 0b11110000, 0b11111111, 0b00000001, 0b00000000, 0b00000000, 0b10000000, 0b11111111, 0b00001111, 0b00000000, 0b00000000, 0b00000000, 0b11111100, 0b01111111, 0b00000000, 0b11111111, 0b00011111, 0b11100000, 0b11111111, 0b00000011, 0b00000000, 0b00000000, 0b00000000, 0b11111111, 0b00011111, 0b11000000, 0b11111111, 0b00000011, 0b00000000, 0b00000000, 0b00000000, 0b11111110, 0b00111111};

#define REP_BUTTON_MSG 3
#define REP_BUTTON_SIZE 27
const uint8_t REP_BUTTON[REP_BUTTON_SIZE] = {0b11111110, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b00000111, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11110000, 0b11111111};

#define VOL_UP_BUTTON_MSG 4
#define VOL_UP_BUTTON_SIZE 162
const uint8_t VOL_UP_BUTTON[VOL_UP_BUTTON_SIZE] = {0b11111110, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b00000011, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00000111, 0b00000000, 0b00000000, 0b00000000, 0b11111110, 0b00111111, 0b10000000, 0b11111111, 0b00001111, 0b11110000, 0b11111111, 0b00000001, 0b11111100, 0b01111111, 0b10000000, 0b11111111, 0b00001111, 0b11100000, 0b11111111, 0b00000011, 0b11111100, 0b01111111, 0b00000000, 0b11111111, 0b00011111, 0b11100000, 0b11111111, 0b00000011, 0b00000000, 0b00000000, 0b00000000, 0b11111111, 0b00011111, 0b00000000, 0b00000000, 0b00000000, 0b11111000, 0b11111111, 0b00000001, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00000111, 0b00000000, 0b00000000, 0b00000000, 0b11111110, 0b00111111, 0b00000000, 0b00000000, 0b00000000, 0b11110000, 0b11111111, 0b00000001, 0b00000000, 0b00000000, 0b10000000, 0b11111111, 0b00001111, 0b00000000, 0b00000000, 0b00000000, 0b11111100, 0b01111111, 0b00000000, 0b11111111, 0b00011111, 0b11100000, 0b11111111, 0b00000011, 0b11111000, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00000111, 0b00000000, 0b00000000, 0b00000000, 0b11111110, 0b00111111, 0b11000000, 0b11111111, 0b00001111, 0b00000000, 0b00000000, 0b00000000, 0b11111110, 0b00111111, 0b10000000, 0b11111111, 0b00001111, 0b00000000, 0b00000000, 0b00000000, 0b11111100, 0b01111111, 0b00000000, 0b00000000, 0b00000000, 0b11100000, 0b11111111, 0b00000011, 0b00000000, 0b00000000, 0b00000000, 0b11111111, 0b00011111, 0b11100000, 0b11111111, 0b00000111, 0b11111000, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00000111, 0b11111000, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00001111};

#define VOL_DOWN_BUTTON_MSG 5
#define VOL_DOWN_BUTTON_SIZE 162
const uint8_t VOL_DOWN_BUTTON[VOL_DOWN_BUTTON_SIZE] = {0b11111110, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b00000001, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00000011, 0b00000000, 0b00000000, 0b00000000, 0b11111100, 0b00001111, 0b10000000, 0b11111111, 0b00000111, 0b11110000, 0b11111111, 0b00000011, 0b11111100, 0b00011111, 0b10000000, 0b11111111, 0b00000111, 0b11100000, 0b11111111, 0b00000011, 0b11111000, 0b00111111, 0b00000000, 0b11111111, 0b00001111, 0b11100000, 0b11111111, 0b00000111, 0b00000000, 0b00000000, 0b00000000, 0b11111111, 0b00001111, 0b00000000, 0b00000000, 0b00000000, 0b11110000, 0b00111111, 0b00000000, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00001111, 0b00000000, 0b00000000, 0b00000000, 0b11111110, 0b00011111, 0b00000000, 0b00000000, 0b00000000, 0b11100000, 0b01111111, 0b00000000, 0b00000000, 0b00000000, 0b10000000, 0b11111111, 0b00011111, 0b00000000, 0b00000000, 0b00000000, 0b11111100, 0b00111111, 0b00000000, 0b11111111, 0b00011111, 0b00000000, 0b00000000, 0b00000000, 0b11111000, 0b00111111, 0b00000000, 0b11111111, 0b00111111, 0b00000000, 0b00000000, 0b00000000, 0b11111000, 0b01111111, 0b00000000, 0b11111110, 0b00111111, 0b10000000, 0b11111111, 0b00000011, 0b11110000, 0b11111111, 0b00000000, 0b11111110, 0b01111111, 0b00000000, 0b00000000, 0b00000000, 0b11110000, 0b11111111, 0b00000000, 0b11111100, 0b01111111, 0b00000000, 0b00000000, 0b00000000, 0b11100000, 0b11111111, 0b00000000, 0b11111100, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b11100000, 0b11111111, 0b00000001, 0b00000000, 0b00000000, 0b00000000, 0b11111110, 0b00000111, 0b00000000, 0b00000000, 0b00000000, 0b11111000, 0b11111111, 0b00000001, 0b00000000, 0b00000000, 0b11000000, 0b11111111, 0b00000011};

/******************************************************************************/
/* User Global Variable Declaration                                           */
/******************************************************************************/

enum SystemState { SystemOff, SystemBoot, SystemOn, SystemShutdownWait, SystemShutdown };
enum ShutdownPhase { contactOff, lockInactive, lockActive };
enum PredictState { Idle, ContactRecent, ContactNotRecent, Starting };

#define ChangeState(x) do { state = x; stateTimer = 0; } while (0)
#define ChangePredictState(x) do { predictState = x; predictStateTimer = 0; } while (0)
#define testbit(var, bit)  ((var) & (1 << (bit)))

/* Timing */
uint8_t time250Hz = 0;

/* A/D settings */
uint8_t analogState = 0;
uint8_t analog1Value = 0;
uint8_t analog2Value = 0;
uint8_t analog3Value = 0;
uint8_t analog4Value = 0;

/* IR Receiver */
uint16_t irRecState = 0;
uint8_t irRecBytes[400];
uint16_t irLastRecByte = 0;

/* IR Transmitter */
uint16_t irSendBitIndex = 0;
uint8_t irSendMessageIndex = 0;

/* TX */
uint16_t txIndex = 0;

/* State Machines */
uint8_t state = SystemOff;
uint16_t stateTimer = 0;
uint16_t noKnippers = 65535;
bool knipperedWhileWait = 0;
uint8_t shutdownPhase = contactOff;

uint8_t predictState = Idle;
uint16_t predictStateTimer = 0;
uint8_t contactOffCounter = 255;
uint8_t startOffCounter = 255;
uint16_t pumpOnCounter = 0;

uint16_t timeSinceUnlock = 65535;
uint16_t timeUnlockFakeRemaining = 65535;
bool Lock = 0;
bool LockRealPrev = 0;

#endif	/* GLOBALS_H */